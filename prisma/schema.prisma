generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("MONGODB_URI")
}

model User {
  id            String          @id @default(auto()) @map("_id") @db.ObjectId
  email         String         @unique
  name          String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  contributions CoveragePoint[]
  measurements  Measurement[]
}

model CoveragePoint {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  location       Json      // { lat: number, lng: number }
  signalStrength Float
  provider       String
  type           String    // 'cellular' or 'wifi'
  technology     String    // '2G', '3G', '4G', '5G'
  reliability    Float
  timestamp      DateTime  @default(now())
  userId         String?   @db.ObjectId
  user           User?     @relation(fields: [userId], references: [id])
  history        CoverageHistory[]
  verifications  Int       @default(0)
  lastVerified   DateTime  @default(now())
  predictedArea  Json?     // Polygon of predicted coverage area
  metadata       Json?     // Additional metadata for coverage point
}

model CoverageHistory {
  id              String        @id @default(auto()) @map("_id") @db.ObjectId
  coveragePointId String        @db.ObjectId
  coveragePoint   CoveragePoint @relation(fields: [coveragePointId], references: [id])
  signalStrength  Float
  timestamp       DateTime      @default(now())
  userId          String?       @db.ObjectId
  metadata        Json?         // Weather conditions, time of day, etc.
}

model WifiHotspot {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  location     Json
  provider     String
  speed        String?
  isPublic     Boolean  @default(true)
  lastVerified DateTime @default(now())
}

model Measurement {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  type      String   // 'speed', 'signal', or 'latency'
  value     Float
  unit      String
  location  Json
  timestamp DateTime @default(now())
  device    Json
  user      User     @relation(fields: [userId], references: [id])
}

model CoverageComparison {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  location    Json     // { lat: number, lng: number }
  providers   Json[]   // Array of provider comparisons
  timestamp   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
